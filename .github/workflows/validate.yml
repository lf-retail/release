name: Compare Commits

on:
  workflow_dispatch:
    inputs:
      releaseBranch:
        description: 'Release Branch'
        required: true
        type: string

jobs:
  compare-commits:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: List commits in main branch
        id: list-commits-main
        run: |
          git fetch origin main
          MAIN_COMMITS=$(git log --format="%H" main)
          echo "::set-output name=main_commits::$MAIN_COMMITS"

      - name: List commits in Dev branch
        id: list-commits-dev
        run: |
          git fetch origin Dev
          DEV_COMMITS=$(git log --format="%H" Dev)
          echo "::set-output name=dev_commits::$DEV_COMMITS"

      - name: Check for hotfix/bugfix branch commits in main
        run: |
          MAIN_COMMITS="${{ steps.list-commits-main.outputs.main_commits }}"
          DEV_COMMITS="${{ steps.list-commits-dev.outputs.dev_commits }}"

          for COMMIT in $MAIN_COMMITS; do
            if [[ "$DEV_COMMITS" == *"$COMMIT"* ]]; then
              echo "Error: Commit $COMMIT from main is in the Dev branch."
              exit 1
            fi
          done

      - name: Check if Dev is behind main
        id: check-dev-behind-main
        run: |
          git fetch origin Dev:Dev
          git fetch origin main:main
          DIFF_COMMITS=$(git log main..Dev --oneline)
          if [[ -n "$DIFF_COMMITS" ]]; then
            echo "Error: Dev branch is behind the main branch."
            exit 1
          fi
